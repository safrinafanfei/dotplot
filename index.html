<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Adding Labels</title>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<style type="text/css">
			body {
  				font-family: 'roboto',arial,helvetica,sans-serif !important;
				font-size: 20px;
			}

			h1{
				color: #333;
				font-size:1.0em;
  				font-family: 'crimson', serif;
				margin: 20px 0 0 0px;
			}

			h3{
				color: #333;
				font-size:1.0em;
  				font-family: 'crimson', serif;
				margin: 0 0 20px 0px;
			}

			p {
				margin-left: 100px;
				font-size: 11pt;
				color: black;
			}
			#main{
				width: 1000px;
				display: block;
				margin: 0 auto;
			}
			div.y2015 {
				color: #057D9F;
				display: inline;
			}
			div.y2000 {
				color: #FFB300;
				display: inline;
			}

			svg {
/*				background-color: #d3d3d3;
*/				display: block;
				margin: 0 auto;
			}

			circle {
				stroke-width: 1;
			}

			circle.newdata {
				fill: #057D9F;
			}

			circle.y2000 {
				fill: #FFB300;
			}

			circle:hover {
				opacity: .5;
			}

			line.grid {
				stroke: #eee;
			}

/*			line.between {
				stroke: #B0AA9A;
			}*/

			.axis path,
			.axis line {
				fill: none;
				stroke: #eee;
				shape-rendering: crispEdges;
			}

			.axis text {
  				font-family: 'roboto',arial,helvetica,sans-serif !important;
				font-size: 11px;
			}

			.xlabel {
  				font-family: 'roboto',arial,helvetica,sans-serif !important;
				font-size: 11px;
				color: gray;
			}

			/*//slider*/
			#slider{
			  width:48%;
			  height: 4px;
			  border: solid;
			  border-width: 1px;
			  border-color: #CCC;
			  background-color: #f5f5f5;
			}

			.slidercontainer{
			  position:relative;
			  width: 60%;
			  margin-bottom: 10px;

			}

			.yearTick {
			    position: absolute;
			    width: 1px;
			    height: 5px;
			    left: 0;
			    top: 10px;
			    background: #DDD;
			}

			.yearLabel {
			    position: absolute;
			    width: 20px;
			    height: 13px;
			    top: 41px;
			    background: #FFF;
			    font: 11px arial,helvetica,sans-serif;
			    color: #999;
			    text-align: center;
			}

			#play{
			    display: inline-block;
			    border-radius: 4px;
			    background-color: #eeeeee;
			    border: none;
			    color: black;
			    text-align: center;
			    font-size: 14px;
			    padding: 5px;
			    width: 50px;
			    transition: all 0.5s;
			    cursor: pointer;
			}

			.difftext, .realnumber, .realnumbernew{
				font-size: 0.6em;
				color:#333;
				background-color: #eee;
			}

/*            .slidercontainer, .instruction{
                float:left;
            }


*/
            .chart{
                margin-top: -100px;
            }


		</style>
	</head>
	<body>

		<div id="main">
			<h1>Opioid Overdose Death Rates and All Drug Overdose Death Rates per 100,000 Population (Age-Adjusted)</h1>
			<h3><div class="y2000">2000</div> versus <div class="y2015">2015</div></h3>
			<div class="slidercontainer">
			    <input id="slider" type="range" min="2000" max="2015" value="2000" step="1">
			    <span id="range">2000</span>
			    <div class="yearLabel" style="left:0%">'00</div>
			    <div class="yearLabel" style="left:3.125%">'01</div>
			    <div class="yearLabel" style="left:6.25%">'02</div>
			    <div class="yearLabel" style="left:9.375%">'03</div>
			    <div class="yearLabel" style="left:12.5%">'04</div>
			    <div class="yearLabel" style="left:15.625%">'05</div>
			    <div class="yearLabel" style="left:18.75%">'06</div>
			    <div class="yearLabel" style="left:21.875%">'07</div>
			    <div class="yearLabel" style="left:25%">'08</div>
			    <div class="yearLabel" style="left:28.125%">'09</div>
			    <div class="yearLabel" style="left:31.25%">'10</div>
			    <div class="yearLabel" style="left:34.375%">'11</div>
			    <div class="yearLabel" style="left:37.5%">'12</div>
			    <div class="yearLabel" style="left:40.625%">'13</div>
			    <div class="yearLabel" style="left:43.75%">'14</div>
			    <div class="yearLabel" style="left:46.875%">'15</div>


			    <button class="button" name="play" id="play"><span>Play</span></button>
			</div>
            


			<div class="chart">
    <!-- Generated by ai2html v0.63 - 2017-04-10 - 16:37 -->
    <!-- ai file: instruction -->

    <style type='text/css' media='screen,print'>
        .g-artboard {
            margin:0 auto;
        }
    </style>


    <!-- Artboard: Artboard_1 -->
    <div id='g-instruction-Artboard_1' class='g-artboard g-artboard-v3 instruction' data-min-width='320'>
        <style type='text/css' media='screen,print'>
            #g-instruction-Artboard_1{
                position:relative;
                overflow:hidden;
                width:320px;
                top: 163px;
                left: 38%;
            }
            .g-aiAbs{
                position:absolute;
            }
            .g-aiImg{
                display:block;
                width:100% !important;
            }
            #g-instruction-Artboard_1 p{
                font-family:nyt-franklin,arial,helvetica,sans-serif;
                font-size:13px;
                line-height:18px;
                margin:0;
            }
            #g-instruction-Artboard_1 .g-aiPstyle0 {
                font-family:arial,helvetica,sans-serif;
                font-size:10px;
                line-height:11px;
                color:#333333;
            }
            #g-instruction-Artboard_1 .g-aiPstyle1 {
                font-family:arial,helvetica,sans-serif;
                font-size:10px;
                line-height:12px;
                color:#333333;
            }
            #g-instruction-Artboard_1 .g-aiPstyle2 {
                font-family:arial,helvetica,sans-serif;
                font-size:12px;
                line-height:14px;
                font-weight:bold;
                color:#000000;
            }
            #g-instruction-Artboard_1 .g-aiPstyle3 {
                font-family:arial,helvetica,sans-serif;
                font-size:12px;
                line-height:14px;
                color:#000000;
            }
            .g-aiPtransformed p { white-space: nowrap; }
        </style>
        <div id='g-instruction-Artboard_1-graphic'>
            <img id='g-ai0-0'
                class='g-aiImg'
                src='instruction-Artboard_1.png'
                />
            <div id='g-ai0-1' class='g-Layer_1 g-aiAbs' style='top:11.7883%;left:7.0161%;'>
                <p class='g-aiPstyle0'>Not sufficient data. </p>
                <p class='g-aiPstyle0'>Data supressed to ensure </p>
                <p class='g-aiPstyle0'>confidentiality.</p>
            </div>
            <div id='g-ai0-2' class='g-Layer_1 g-aiAbs' style='top:23.5766%;left:64.706%;'>
                <p class='g-aiPstyle1'>change from 2000</p>
            </div>
            <div id='g-ai0-3' class='g-Layer_1 g-aiAbs' style='top:39.0876%;left:73.4069%;'>
                <p class='g-aiPstyle2'>+ 2.3</p>
            </div>
            <div id='g-ai0-4' class='g-Layer_1 g-aiAbs' style='top:55.8394%;left:61.2746%;'>
                <p class='g-aiPstyle0'>year chosen</p>
                <p class='g-aiPstyle0'>for comparison</p>
            </div>
            <div id='g-ai0-5' class='g-Layer_1 g-aiAbs' style='top:55.8394%;left:27.0834%;'>
                <p class='g-aiPstyle1'>2000 </p>
            </div>
            <div id='g-ai0-6' class='g-Layer_1 g-aiAbs' style='top:80.0365%;left:15.9512%;'>
                <p class='g-aiPstyle3'>Mouse over to see overdose death rates</p>
            </div>
        </div>
    </div>


    <!-- End ai2html - 2017-04-10 - 16:37 -->
			</div>

			<p>Note: Age-adjusted death rates were calculated by applying age-specific death rates to the 2000 U.S. standard population age distribution. Death Rates are deaths per 100,000 population (age-adjusted).</p>
            <p>Source: Kaiser Family Foundation analysis of Centers for Disease Control and Prevention (CDC), National Center for Health Statistics.</p>
		</div>
		
	</body>

<script type="text/javascript">
			// this is the size of the svg container -- the white part
		var fullwidth = window.innerWidth>1000?innerWidth/2:innerWidth/1.1,
			fullheight = 700;

			// these are the margins around the graph. Axes labels go in margins.
		var margin = {top: 20, right: 25, bottom: 20, left: 100};

		var width = fullwidth - margin.left - margin.right,
    		height = fullheight - margin.top - margin.bottom;

		var widthScale = d3.scale.linear()
							.range([ 0, width]);

		widthScale.domain([0, 40]);

		var heightScale = d3.scale.ordinal()
							.rangeRoundBands([ margin.top, height], 0.2);

		var xAxis = d3.svg.axis()
						.scale(widthScale)
						.orient("bottom");

		var yAxis = d3.svg.axis()
						.scale(heightScale)
						.orient("left")
						.innerTickSize([0]);

		var svg = d3.select(".chart")
					.append("svg")
					.attr("width", fullwidth)
					.attr("height", fullheight);

function drawDotplot() {
	var myData; 

    d3.csv("data.csv", InitChart);

    function InitChart(error, data) {
        if (error) {
            console.log("error reading file");
        }
        myData = data;
        // data.sort(function(a, b) {
        // 	return d3.descending(+a[newdata], +b[newdata]);
        // });

        heightScale.domain(data.map(function(d) {
            return d.region;
        }));


        var linesGrid = svg.selectAll("lines.grid")
            .data(data)
            .enter()
            .append("line");

        linesGrid.attr("class", "grid")
            .attr("x1", margin.left)
            .attr("y1", function(d) {
                return heightScale(d.region) + heightScale.rangeBand() / 2;
            })
            .attr("x2", function(d) {
                return margin.left + widthScale(+d.y2015);
            })
            .attr("y2", function(d) {
                var hey = heightScale(d.region) + heightScale.rangeBand() / 2;
                return hey;
            });


        // js map: will make a new array out of all the d.region fields
        var linesBetween = svg.selectAll("lines.between")
            .data(data)
            .enter()
            .append("line");

        linesBetween.attr("class", "between")
            .attr("x1", function(d) {
                if (isNaN(d.y2000)) {
                    return margin.left;
                } else {
                    return margin.left + widthScale(+d.y2000);
                }
            })
            .attr("y1", function(d) {
                return heightScale(d.region) + heightScale.rangeBand() / 2;
            })
            .attr("x2", function(d) {
                return margin.left + widthScale(d.y2015);
            })
            .attr("y2", function(d) {
                return heightScale(d.region) + heightScale.rangeBand() / 2;
            })
            .attr("stroke-width", "9")
            .attr("stroke", function(d) {
                if (isNaN(d.y2000)) {
                    return "#eeeeee"
                } else {
                    return "#B0AA9A"
                }
            });
            

        var linesHover = svg.selectAll("lines.hover")
            .data(data)
            .enter()
            .append("line");

        linesHover.attr("class", function(d){
            return "hover_"+ d.region 
        })
            .attr("x1", function(d) {
                    return margin.left;
            })
            .attr("y1", function(d) {
                return heightScale(d.region) + heightScale.rangeBand() / 2;
            })
            .attr("x2", function(d) {
                return margin.left + widthScale(d.y2015);
            })
            .attr("y2", function(d) {
                return heightScale(d.region) + heightScale.rangeBand() / 2;
            })
            .attr("stroke-width", "9")
            .attr("stroke", "#C4D7DD")
            .style("opacity","0")
            .on("mouseover", handleMouseOver)
            .on("mouseout", handleMouseOut);

            function handleMouseOver(d){
                d3.select(this).style("opacity","1");
                d3.select(".realnumber_" + d.abbr).style("opacity","1");
                d3.select(".difftext_" + d.abbr).style("opacity","0");
                d3.select(".realnumbernew_" + d.abbr).style("opacity","1");
            }

            function handleMouseOut(d){
                d3.select(this).style("opacity","0");
                d3.select(".realnumber_" + d.abbr).style("opacity","0");
                d3.select(".difftext_" + d.abbr).style("opacity","1");
                d3.select(".realnumbernew_" + d.abbr).style("opacity","0");
            }

        // Make the dots for 2000
        var dots2000 = svg.selectAll("circle.y2000")
            .data(data)
            .enter()
            .append("circle");

        dots2000
            .attr("class", "y2000")
            .attr("cx", function(d) {
                if (isNaN(d.y2000)) {
                    return margin.left;
                } else {
                    return margin.left + widthScale(+d.y2000);
                }
            })
            .attr("r", heightScale.rangeBand() / 1.8)
            .attr("cy", function(d) {
                return heightScale(d.region) + heightScale.rangeBand() / 2;
            })
            .style("fill", function(d) {
                if (isNaN(d.y2000)) {
                    return "#eeeeee";
                } else if (d.region === "United States") {
                    return "#CC0000";
                }
            })
            .append("title");
        // add the axes

        svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(" + margin.left + "," + height + ")")
            .call(xAxis);

        svg.append("g")
            .attr("class", "y axis")
            .attr("transform", "translate(" + margin.left + ",0)")
            .call(yAxis);

        svg.append("text")
            .attr("class", "xlabel")
            .attr("transform", "translate(" + (margin.left + width / 2) + " ," +
                (height + margin.bottom) + ")")
            .style("text-anchor", "middle")
            .attr("dy", "12")
            .text("per 100,000 population");

        var dotsnew = svg.selectAll("circle.new")
            .data(data)
            .enter()
            .append("circle");

        dotsnew
            .attr("class", "newdata")
            .attr("cx", function(d) {
                return margin.left + widthScale(d.y2015);
            })
            .attr("r", heightScale.rangeBand() / 1.8)
            .attr("cy", function(d) {
                return heightScale(d.region) + heightScale.rangeBand() / 2;
            })
            .style("fill", function(d) {
                if (d.region === "United States") {
                    return "#CC0000";
                }
            })
            .append("title")
            .text(function(d) {
                return d.region + " in 2013: " + d.y2015 + "%";
            });
        // Style one of the Y labels bold:
        var allYAxisLabels = d3.selectAll("g.y.axis g.tick text")[0]; // un-nest array

        var diff = svg.selectAll("text.diff")
        			.data(myData)
        			.enter()
        			.append("text")
        			.attr("class",function(d){return "difftext difftext_" + d.abbr})
        			.attr("x", function(d) {
               			return margin.left + widthScale(d.y2015) + 10; 
           			 })
        			.attr("y", function(d) {
                		return heightScale(d.region) + heightScale.rangeBand() / 2 + 5;
            		})
        			.text(function(d) {
        				if (isNaN(d.y2015 -d.y2000)){
        					return ""
        				}else{
        					return "+" + (d.y2015 -d.y2000).toFixed(1);
        				}
            		});

        var realNumber = svg.selectAll("text.real")
                    .data(myData)
                    .enter()
                    .append("text")
                    .attr("class",function(d){return "realnumber realnumber_" + d.abbr})
                    .attr("x", function(d) {
                        return margin.left + widthScale(d.y2000) - 25; 
                     })
                    .attr("y", function(d) {
                        return heightScale(d.region) + heightScale.rangeBand() / 2 + 5;
                    })
                    .text(function(d) {
                        if (isNaN(d.y2000)){
                            return ""
                        }else{
                            return (+d.y2000).toFixed(1);
                        }
                    })
                    .style("opacity",0);
        var realNumberNew = svg.selectAll("text.realnew")
                    .data(myData)
                    .enter()
                    .append("text")
                    .attr("class",function(d){return "realnumbernew realnumbernew_" + d.abbr})
                    .attr("x", function(d) {
                        return margin.left + widthScale(d.y2015) + 10; 
                     })
                    .attr("y", function(d) {
                        return heightScale(d.region) + heightScale.rangeBand() / 2 + 5;
                    })
                    .text(function(d) {
                        if (isNaN(d.y2015)){
                            return ""
                        }else{
                            return (+d.y2015).toFixed(1);
                        }
                    })
                    .style("opacity",0);
    };



   
    function updateChart(datanew) {

        d3.csv("data.csv", function(error, data) {
            if (error) {
                console.log("error reading file");
            }
            heightScale.domain(data.map(function(d) {
                return d.region;
            }));

            // data.sort(function(a, b) {
            // 	return d3.descending(+a.y2015, +b.y2015);
            // });

            var linesGrid = d3.selectAll(".grid");

            linesGrid
                .attr("x1", margin.left)
                .attr("y1", function(d) {
                    return heightScale(d.region) + heightScale.rangeBand() / 2;
                })
                .attr("x2", function(d) {
                    // console.log(widthScale(+d[datanew]));
                    if (isNaN(d[datanew])) {
                        return margin.left;
                    } else {
                        return margin.left + widthScale(+d[datanew]);
                    }
                })
                .attr("y2", function(d) {
                    return heightScale(d.region) + heightScale.rangeBand() / 2;
                });

            var linesBetween = d3.selectAll(".between")
                .attr("x1", function(d) {
                    if (isNaN(d.y2000)) {
                        return margin.left;
                    } else {
                        return margin.left + widthScale(+d.y2000);
                    }
                })
                .attr("y1", function(d) {
                    return heightScale(d.region) + heightScale.rangeBand() / 2;
                })
                .attr("x2", function(d) {
                    if (isNaN(d[datanew])) {
                        return margin.left;
                    } else {
                        return margin.left + widthScale(+d[datanew]);
                    }
                })
                .attr("y2", function(d) {
                    return heightScale(d.region) + heightScale.rangeBand() / 2;
                });

            var dotsnew = d3.selectAll(".newdata")
                .attr("cx", function(d) {
                    if (isNaN(d[datanew])) {
                        return margin.left;
                    } else {
                        var cx = margin.left + widthScale(d[datanew]);
                        console.log(cx);
                        // console.log(heightScale.rangeBand()/1.8)
                        return cx;
                    }
                })
                .attr("r", heightScale.rangeBand() / 1.8)
                .attr("cy", function(d) {
                    var cy = heightScale(d.region) + heightScale.rangeBand() / 2;
                    return cy;
                })
                .style("fill", function(d) {
                    if (d.region === "United States") {
                        return "#CC0000";
                    }else if(isNaN(d[datanew])){
                    	return "#eeeeee";
                    }
                })
                .append("title");

            var diff = d3.selectAll(".difftext")
        			.attr("x", function(d) {
               			return margin.left + widthScale(d[datanew]) + 10; 
           			 })
        			.attr("y", function(d) {
                		return heightScale(d.region) + heightScale.rangeBand() / 2 + 5;
            		})
        			.text(function(d) {
        				var change = (d[datanew] -d.y2000).toFixed(1);
        				if (isNaN(d[datanew] -d.y2000)){
        					return ""
        				}else{
        					if(change > 0){
								return "+" + change;        			
        					}else if (change <= 0){
        						return change;
        					}
        				}
            		});
        });
    }

    function resize(datanew) {
        fullwidth = window.innerWidth /1.1,
            width = fullwidth - margin.left - margin.right,
            height = fullheight - margin.top - margin.bottom;

        widthScale = d3.scale.linear()
            .range([0, width]);

        heightScale = d3.scale.ordinal()
            .rangeRoundBands([margin.top, height], 0.2);

        widthScale.domain([0, 40]);
		
		heightScale.domain(myData.map(function(d) {
            return d.region;
        }));

        xAxis = d3.svg.axis()
            .scale(widthScale)
            .orient("bottom");

        yAxis = d3.svg.axis()
            .scale(heightScale)
            .orient("left")
            .innerTickSize([0]);

        svg = d3.select(".chart")
            .attr("width", fullwidth)
            .attr("height", fullheight);

        d3.select(".chart .x.axis")
            .attr("transform", "translate(" + margin.left + "," + height + ")")
            .call(xAxis);

        d3.selectAll(".grid")
        	.data(myData)
        	.attr("x1", margin.left)
            .attr("y1", function(d) {
            	console.log(heightScale(d.region));
                return heightScale(d.region) + heightScale.rangeBand() / 2;
            })
            .attr("x2", function(d) {
                    // console.log(widthScale(+d[datanew]));
                if (isNaN(d[datanew])) {
                    return margin.left;
                } else {
                    return margin.left + widthScale(+d[datanew]);
                }
            })
            .attr("y2", function(d) {
                return heightScale(d.region) + heightScale.rangeBand() / 2;
            });

        d3.selectAll(".between")
        		.data(myData)
                .attr("x1", function(d) {
                    if (isNaN(d.y2000)) {
                        return margin.left;
                    } else {
                        return margin.left + widthScale(+d.y2000);
                    }
                })
                .attr("y1", function(d) {
                    return heightScale(d.region) + heightScale.rangeBand() / 2;
                })
                .attr("x2", function(d) {
                    if (isNaN(d[datanew])) {
                        return margin.left;
                    } else {
                        return margin.left + widthScale(+d[datanew]);
                    }
                })
                .attr("y2", function(d) {
                    return heightScale(d.region) + heightScale.rangeBand() / 2;
                });

        d3.selectAll(".newdata")
        		.data(myData)
                .attr("cx", function(d) {
                    if (isNaN(d[datanew])) {
                        return margin.left;
                    } else {
                        var cx = margin.left + widthScale(d[datanew]);
                        console.log(cx);
                        // console.log(heightScale.rangeBand()/1.8)
                        return cx;
                    }
                })
                .attr("r", heightScale.rangeBand() / 1.8)
                .attr("cy", function(d) {
                    var cy = heightScale(d.region) + heightScale.rangeBand() / 2;
                    return cy;
                })
                .style("fill", function(d) {
                    if (d.region === "United States") {
                        return "#CC0000";
                    }
                })
                .append("title")
                .text(function(d) {
                    return d.region + " in 2013: " + d[datanew] + "%";
                });

            d3.selectAll("circle.y2000")
            	.data(myData)
            	.attr("cx", function(d) {
	                if (isNaN(d.y2000)) {
	                    return margin.left;
	                } else {
	                    return margin.left + widthScale(+d.y2000);
	                }
            	})
            	.attr("r", heightScale.rangeBand() / 1.8)
            	.attr("cy", function(d) {
               	 	return heightScale(d.region) + heightScale.rangeBand() / 2;
            	})
	            .style("fill", function(d) {
	                if (isNaN(d.y2000)) {
	                    return "#eeeeee";
	                } else if (d.region === "United States") {
	                    return "#CC0000";
	                }
	            })
	            .append("title")
	            .text(function(d) {
	                return d.region + " in 2000: " + d.y2000 + "%";
	            });



    }
    return {"resize": resize, "updateChart": updateChart}; 
}
		
var myChart = drawDotplot();
	var globalDatanew = "y2015";
		
	var running = false;
    var timer;

    $('button').on('click', function() {
        var duration = 1000,
            maxstep = 2015, 
            minstep = 2000;
        // if ($("#slider").val() == 2015){
        //     $('button').html("Replay");
        // }

        if (running == true) {
            $("button").html("play");
            running = false;
            clearInterval(timer);
        } else if (running == false) {
            $('button').html("Pause");

            var sliderValue = $("#slider").val();
            globalDatanew = "y" + sliderValue;
            timer = setInterval(function() {
                if (sliderValue < maxstep) {
                    sliderValue = sliderValue * 1 + 1;
                    $('#slider').val(sliderValue);
                   
                      $('#range').html(sliderValue);                    
                }
                $('#slider').val(sliderValue);
                myChart.updateChart("y" + sliderValue);
            }, duration);
            running = true;
        } 


    });

    $("#slider").on("change", function() {
        var sliderValue = $("#slider").val();
        $('#range').html(sliderValue);  
        if(sliderValue == 2015){
            $('button').html("Replay");
        }else{
            globalDatanew = "y" + sliderValue;
            myChart.updateChart("y" + sliderValue);
            $("#range").html($("#slider").val());
            clearInterval(timer);
            $("button").html("Play");
        }
    });


    
    $(window).resize(function(){myChart.resize(globalDatanew)});



    
 



	</script>

</html>